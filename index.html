<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Raulstoff Canciones</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">

</head>
<body onload="traerDatos();">
    <div>Lista de canciones</div>
    <form class="search-form">
        <input type="text" class="search" placeholder="Canciones">
        

        <div class="container">
            <div class="section">
                
    
                <table id="tabla" class="suggestions">
                    <thead>
                        <tr>
                            <th>Artista</th>
                            <th>Cancion</th>
    
                        </tr>
                    </thead>
                    <tbody id="res">
    
                    </tbody>
    
    
                </table>
            </div>
        </div>
    </form>

<script>
    const endpoint = 'songs.json';

    const canciones = [];
    fetch(endpoint)
    .then(blob => blob.json())
    .then(data => canciones.push(...data));

    function findMatches(wordToMatch, canciones){
        return canciones.filter(place => {
            const regex = new RegExp(wordToMatch, 'gi');
            return place.Name.match(regex) || place.Artist.match(regex)
        });
    }

    function numberWithCommas(x){
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function displayMatches(){
        const matchArray = findMatches(this.value, canciones);
        const html = matchArray.map(place => {
            const regex = new RegExp(this.value, 'gi');
            const songName = place.Name.replace(regex, `<span class=hl>${this.value}</span>`);
            const artistName = place.Artist.replace(regex, `<span class=hl>${this.value}</span>`);
            return `
            <table>
                <thead>
                    <tr>
                        <th>Artista</th>
                        <th>Cancion</th>
                    </tr>
                </thead>
                <tbody >
                    <tr>
                            <td>${artistName}</td>
                            <td>${songName}</td>        
                    </tr>
                </tbody>
            </table>
                `;
        }).join('');
        suggestions.innerHTML = html;
    }


const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

searchInput.addEventListener('change', displayMatches);
searchInput.addEventListener('keyup', displayMatches);


        function traerDatos(){
            console.log('dentro de la funcion');
        
            const xhttp = new XMLHttpRequest();
        
            xhttp.open('GET', 'songs.json', true);
        
            xhttp.send();
        
            xhttp.onreadystatechange = a;
            
            function a (){
        
                if(this.readyState == 4 && this.status == 200){
                   // console.log(this.responseText);
                    let datos = JSON.parse(this.responseText);
                    //console.log(datos);
                    let res = document.querySelector('#res');
                    res.innerHTML = '';
        
                    for(let item of datos){
                        //onsole.log(item)
                        res.innerHTML += `
                            <tr>
                            <td>${item.Artist}</td>
                            <td>${item.Name}</td>
                            </tr>
                        `
                    }
        
                }
            }
        
        }
</script>

</body>


</html>